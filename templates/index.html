<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TranscribeFlow - AI Audio Transcription</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@600;800&family=Playfair+Display:ital,wght@1,900&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}">

</head>

<body>
    <div id="vanta-bg"></div>
    <div id="toast-message" class="success-toast">UPLOAD SUCCESSFUL</div>

    <header class="nav-header">
        <div class="logo-text" onclick="window.location.reload()">TranscribeFlow</div>
        <div class="user-nav">
            <span id="user-greeting" class="user-greeting" style="display:none;"></span>
            <button id="login-btn" class="nav-btn btn-login" onclick="openAuth('login')">
                <svg viewBox="0 0 24 24">
                    <path
                        d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
                </svg>
                Login
            </button>
            <button id="signup-btn" class="nav-btn btn-signup" onclick="openAuth('register')">
                <svg viewBox="0 0 24 24">
                    <path d="M12 2l2.4 7.2h7.6l-6 4.8 2.4 7.2-6-4.8-6 4.8 2.4-7.2-6-4.8h7.6z" />
                </svg>
                Sign Up
            </button>
            <button id="logout-btn" class="nav-btn"
                style="display:none; border: 1px solid #ff3c3c; color:#ff3c3c; background: transparent;"
                onclick="logout()">Logout</button>
        </div>
    </header>

    <!-- ROBOT MASCOT -->
    <div class="bot-container" onclick="openAuthModal()" title="Click to login">
        <div class="bot-body">
            <div class="bot-shine"></div>
            <div class="bot-screen">
                <div class="bot-eye left-eye"></div>
                <div class="bot-eye right-eye"></div>
            </div>
        </div>
    </div>

    <!-- ============================================================
         AUTH MODAL ‚Äî UPDATED
    ============================================================ -->
    <div id="auth-modal" class="modal-overlay" onclick="handleModalBgClick(event)">
        <div class="auth-card" id="auth-card-inner">

            <!-- ‚îÄ‚îÄ LOGIN FORM ‚îÄ‚îÄ -->
            <div id="login-form">
                <h2 style="margin: 0 0 6px 0; font-family: 'Playfair Display', serif;">Welcome Back</h2>
                <p style="margin:0 0 20px; font-size:13px; color:rgba(255,255,255,0.4);">Sign in to your account</p>

                <input type="text" id="login-identifier" class="auth-input" placeholder="Email address">
                <input type="password" id="login-password" class="auth-input" placeholder="Password">
                <div class="auth-error" id="login-error"></div>

                <button class="auth-btn" onclick="loginUser()">Log In</button>
                <a class="forgot-link" onclick="switchToForgot()">Forgot your password?</a>

                <div class="auth-divider"><span>OR</span></div>
                <div class="toggle-text">No account? <span onclick="toggleAuthMode('register')">Create one free</span>
                </div>
            </div>

            <!-- ‚îÄ‚îÄ REGISTER FORM ‚îÄ‚îÄ -->
            <div id="register-form" style="display:none;">
                <h2 style="margin: 0 0 6px 0; font-family: 'Playfair Display', serif;">Join TranscribeFlow</h2>
                <p style="margin:0 0 20px; font-size:13px; color:rgba(255,255,255,0.4);">Create your free account</p>

                <input type="text" id="reg-name" class="auth-input" placeholder="Full Name">
                <input type="email" id="reg-email" class="auth-input" placeholder="Email Address">
                <input type="password" id="reg-password" class="auth-input" placeholder="Create Password"
                    oninput="checkPasswordStrength(this.value)">

                <!-- Password strength meter -->
                <div class="pwd-meter-wrap">
                    <div class="pwd-meter-bar">
                        <div class="pwd-meter-fill" id="pwd-meter-fill"></div>
                    </div>
                    <div class="pwd-meter-text" id="pwd-meter-text">Enter a password</div>
                </div>
                <ul class="pwd-rules" id="pwd-rules">
                    <li id="rule-len">At least 8 characters</li>
                    <li id="rule-upper">One uppercase letter (A‚ÄìZ)</li>
                    <li id="rule-special">One special character (!@#$‚Ä¶)</li>
                </ul>

                <div class="auth-error" id="reg-error"></div>
                <button class="auth-btn" id="reg-btn" onclick="registerUser()">Create Account</button>

                <div class="auth-divider"><span>OR</span></div>
                <div class="toggle-text">Already have an account? <span onclick="toggleAuthMode('login')">Log In</span>
                </div>
            </div>

            <!-- ‚îÄ‚îÄ FORGOT PASSWORD FORM ‚îÄ‚îÄ -->
            <div id="forgot-form" style="display:none;">
                <h2 style="margin: 0 0 6px 0; font-family: 'Playfair Display', serif;">Reset Password</h2>
                <p style="margin:0 0 20px; font-size:13px; color:rgba(255,255,255,0.4);">Enter your registered email and
                    we'll send a reset link.</p>

                <input type="email" id="forgot-email" class="auth-input" placeholder="Your Email Address">
                <div class="auth-error" id="forgot-error"></div>
                <div class="auth-success" id="forgot-success"></div>

                <button class="auth-btn" id="forgot-btn">Send Reset Link</button>
                <div class="toggle-text" style="margin-top:16px;">
                    <span onclick="toggleAuthMode('login')">Back to Login</span>
                </div>
            </div>

            <button onclick="closeAuthModal()"
                style="background:none; border:none; color:#555; margin-top:18px; cursor:pointer; font-size:12px; letter-spacing:1px;">CLOSE</button>
        </div>
    </div>

    <!-- LANDING -->
    <section id="landing-view">
        <h1 class="landing-title">Audio to Insight<br>Instantly.</h1>
        <p style="opacity: 0.5; margin-bottom: 40px; max-width: 400px; line-height: 1.6;">Leverage professional-grade AI
            to transcribe and summarize your meetings, lectures, and voice notes.</p>
        <button class="start-btn" onclick="enterApp()">Start Transcribing</button>
    </section>

    <!-- APP VIEW (unchanged) -->
    <main id="app-view">
        <div class="hero-section">
            <h1 class="hero-headline">Full Audio Analysis</h1>
            <p style="opacity:0.6;">Transcribe, summarize, and archive with precision.</p>
        </div>

        <div class="upload-card">
            <form id="main-upload-form" enctype="multipart/form-data">
                <label for="audio-input" class="drop-zone" id="drop-zone">
                    <div class="upload-pod">
                        <div class="pulse-ring" id="pulse"></div>
                        <div id="icon">üéß</div>
                    </div>
                    <div id="text-wrap" style="text-align: center;">
                        <span style="font-weight: 800; font-size: 18px; display: block;">Select Audio Or Drag and Drop</span>
                        <span style="font-size: 12px; opacity: 0.5;">MP3, WAV, M4A, FLAC, AAC, OGG</span>
                    </div>
                    <span id="file-name-display"
                        style="margin-top: 10px; color: #00ffff; font-weight: 800; text-align: center;"></span>
                    <input type="file" name="audio" id="audio-input" style="display: none;" required>
                    <div id="format-error" class="error-message">Error: Invalid audio format.</div>
                </label>

                <div id="preview-container">
                    <p>LIVE PREVIEW</p>
                    <audio id="audio-live-preview" class="preview-audio-player" controls></audio>
                    <div id="waveform" style="margin-top:20px;"></div>
                </div>


                <button type="submit" id="submit-btn" class="submit-btn">Transcribe Now</button>
            </form>
        </div>

        <div id="progress-container" class="progress-container">
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill"></div>
            </div>
            <div class="progress-message" id="progress-message">Waking up the neural engine...</div>
            <div id="progress-percent"
                style="text-align:center; color:#00ff88; font-weight:800; margin-top:10px; font-size: 18px; letter-spacing: 1px;">
                0%</div>
        </div>

        <div id="dynamic-result-panel" class="result-panel" style="display: none;">
            <h2
                style="font-family: 'Playfair Display', serif; font-size: 32px; margin-bottom: 35px; text-align: center; background: linear-gradient(to right, #00ffff, #ffffff); background-clip: text; -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                Intelligence Report</h2>

            <span class="result-label">Report Tools</span>
            <div class="report-controls">
                <input type="text" id="transcript-search" class="lang-select" placeholder="üîç Search keywords..."
                    oninput="searchTerm()">
                <button id="autoscroll-btn" class="translate-action-btn" onclick="toggleAutoScroll()"
                    style="background: rgba(255,255,255,0.1); color: white; border: 1px solid #00ffff; min-width: 140px;">Auto-Scroll:
                    OFF</button>
            </div>

            <span class="result-label">Translate Report</span>
            <div class="report-controls">
                <select id="report-lang-select" class="lang-select">
                    <option value="en">English (Original)</option>
                    <option value="hi">Hindi (‡§π‡§ø‡§®‡•ç‡§¶‡•Ä)</option>
                    <option value="es">Spanish (Espa√±ol)</option>
                    <option value="fr">French (Fran√ßais)</option>
                    <option value="de">German (Deutsch)</option>
                    <option value="zh-CN">Chinese (Simplified)</option>
                    <option value="ja">Japanese (Êó•Êú¨Ë™û)</option>
                    <option value="ar">Arabic (ÿßŸÑÿπÿ±ÿ®Ÿäÿ©)</option>
                </select>
                <button id="translate-btn" class="translate-action-btn" onclick="translateReport()">Update
                    Language</button>
            </div>

            <span class="result-label">Full Transcription</span>
            <div id="dynamic-transcript-box" class="transcript-box"></div>

            <span class="result-label">AI Summary</span>
            <div id="dynamic-summary-box" class="summary-box"></div>

            <div class="download-actions">
                <a id="current-download-txt" href="javascript:void(0)" class="download-btn"
                    onclick="downloadFile('txt')"><span>üìÑ</span>
                    Export TXT</a>
                <a id="current-download-docx" href="javascript:void(0)" class="download-btn"
                    onclick="downloadFile('docx')">
                    <span>üìù</span> Export DOCX
                </a>

            </div>
        </div>

        <div
            style="display: flex; justify-content: space-between; align-items: center; width: 100%; max-width: 800px; margin-top: 40px; margin-bottom: 20px;">
            <h2 style="margin: 0;">History</h2>
            {% if files %}
            <button onclick="confirmPurge()"
                style="background: rgba(255, 100, 0, 0.1); color: #ff8c00; border: 1px solid rgba(255, 140, 0, 0.3); padding: 10px 20px; border-radius: 15px; font-size: 12px; font-weight: 800; cursor: pointer;">PURGE
                ALL</button>
            {% endif %}
        </div>

        <div class="file-list-container">
            {% if files %}
            {% for file in files %}
            <div class="file-item" id="file-{{ loop.index }}">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <div>
                        <span style="font-weight: 600; display:block;">üìÑ {{ file.name }}</span>
                        <span style="font-size:10px; opacity:0.5;">{{ file.time }}</span>
                    </div>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <a href="javascript:void(0)" onclick="downloadHistoryFile('{{ file.name }}', 'txt')"
                            style="text-decoration: none; font-size: 12px; color: #00ffff; font-weight: 800;">TXT</a>
                        <a href="javascript:void(0)" onclick="downloadHistoryFile('{{ file.name }}', 'docx')"
                            style="text-decoration: none; font-size: 12px; color: #00ffff; font-weight: 800;">
                            DOCX
                        </a>

                        <button onclick="confirmDelete('{{ file.name }}', 'file-{{ loop.index }}')"
                            style="background:none; border:none; color:#ff3c3c; cursor:pointer; font-weight:800; font-size:12px;">DELETE</button>
                    </div>
                </div>
                <audio controls>
                    <source src="{{ url_for('transcription.serve_audio', filename=file.name) }}" type="audio/mpeg">
                </audio>
            </div>
            {% endfor %}
            {% else %}
            <p style="text-align: center; opacity: 0.4;">No history found.</p>
            {% endif %}
        </div>
    </main>
    <div class="modal-overlay" id="otp-modal" style="display:none;">
    <div class="auth-card">
        <h2 style="font-family:'Playfair Display', serif;">Verify OTP</h2>
        <p style="opacity:0.5;">Enter the 6-digit OTP sent to your email</p>

        <input type="text" id="otp-input" class="auth-input" placeholder="Enter OTP">
        <div id="otp-error" class="auth-error"></div>

        <button class="auth-btn" onclick="verifyOTP()">Verify</button>
        <button onclick="closeOtpModal()" style="margin-top:10px;background:none;border:none;color:#777;">Cancel</button>
    </div>
    </div>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.waves.min.js"></script>
    <script src="https://unpkg.com/wavesurfer.js@7/dist/wavesurfer.min.js"></script>
    <script src="{{ url_for('static', filename='js/index.js') }}"></script>
</body>
</html>